(self["webpackChunkdemo_vue2"]=self["webpackChunkdemo_vue2"]||[]).push([[594],{3947:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"index"},[t("ul",e._l(e.message,(function(s,n){return t("li",{key:n,class:{rightText:e.userId==s.id}},[e._v(" "+e._s(s.msg)+" - "+e._s(s.times)+" ")])})),0),e._v(" 页面二 "),t("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}}),e.wsOpen?t("el-button",{attrs:{type:"warning",round:""},on:{click:e.closeWs}},[e._v("离开")]):t("el-button",{attrs:{type:"info",round:""},on:{click:e.initWs}},[e._v("开启"+e._s(e.wsOpen))]),t("el-button",{attrs:{type:"info",round:""},on:{click:e.sendMsg}},[e._v("信息按钮2")]),t("chatCom")],1)},o=[],r=(s(4114),s(3518)),i=s(7741),l=s(8324),a=s(6846);class c{constructor(){this.isConnet=!1,this.forbidReconnect=!1,this.timeout=2e3,this.ws=null,this.rec=null,this.list=[]}initHeartBeat(){let e=this;this.heartCheck={timeout:2e3,timeoutObj:null,serverTimeoutObj:null,heartreset:()=>{clearTimeout(this.timeoutObj),clearTimeout(this.serverTimeoutObj)},reset:function(){this.heartreset(),this.start()},start:()=>{this.timeoutObj=setTimeout((()=>{e.ws.send(JSON.stringify({type:"ping"})),this.serverTimeoutObj=setTimeout((()=>{e.ws.close()}),this.timeout)}),this.timeout)}}}createWs(){console.log("测试",a.$.ws_url);try{const e=localStorage.getItem("userId");this.ws=new WebSocket(`${a.$.ws_url}/socket/ws?userId=`+e),this.initWs(),this.initHeartBeat(),console.log("开启连接")}catch{console.log("重连失败"),this.reConnect()}}initWs(){let e=this;this.ws.onopen=t=>{console.log("连接成功",t,e.heartCheck),e.heartCheck.heartreset(),e.heartCheck.start()},this.ws.onmessage=t=>{console.log("接收到消息",JSON.parse(t.data));let s=JSON.parse(t.data);e.tig(s)},this.ws.onerror=e=>{console.log("连接错误",e)},this.ws.onclose=t=>{console.log("连接关闭",t),e.heartCheck.heartreset(),e.reConnect()}}subscribe(e){this.list.push(e)}tig(e){this.list.forEach((function(t){t&&t(e)}))}reConnect(){this.isConnet||this.forbidReconnect||(this.isConnet=!0,this.rec&&clearTimeout(this.rec),this.rec=setTimeout((()=>{console.log("开始重连"),this.createWs(),this.isConnet=!1}),2e3))}sendMsg(e){if(!this.ws)return;console.log("发送消息",this.ws,this.ws?.readyState);let t={time:(new Date).getTime(),msg:e};this.ws?.send(JSON.stringify(t))}closeWs(){this.forbidReconnect=!0,this.heartCheck.heartreset(),this.ws?.close(),this.ws=null}}var u=new c,h={name:"indexPage",data(){return{input:"",message:[],rightTextShow:!1,userId:"",worldMsg:[],wsOpen:!1}},created(){this.reqInfo(),this.reqWorldMsg(),this.userId=localStorage.getItem("userId")},destroyed(){this.closeWs()},methods:{...(0,r.i0)([l.qV,l._8]),openMap(){this.$router.push({path:"/MapContainer"})},openThree(e){this.$router.push({path:e})},async reqWorldMsg(){const e=await this[l._8]();if(200==e.code){console.log("msginfo",e);let t=[];e.data.forEach(((e,s)=>{e.msgList.forEach(((s,n)=>{t.push({id:e.userId,msg:s.msg,times:s.time})}))})),t.sort(((e,t)=>e.times-t.times)).map((e=>e.times=(0,i.yw)(e.times))),this.message=t,console.log("处理信息",t)}},async reqInfo(){const e=await this[l.qV]();console.log("请求4",e),200==e.code?console.log("请求成功",e):401==e.code&&this.$router.push({name:"home"})},initWs(){console.log("wsUtil",u),u.createWs(),this.initWsMsg(),this.wsOpen=!this.wsOpen},sendMsg(){u.sendMsg(this.input),this.$notify({title:"成功",message:"发送成功",type:"success"})},initWsMsg(){u.subscribe((e=>{"pong"==e.type?u.heartCheck.reset():(e.times=(0,i.yw)(e.time),console.log("收到消息",e),this.message.push(e))}))},closeWs(){u.closeWs(),this.wsOpen=!1,this.$notify({title:"成功",message:"退出成功",type:"success"})}}},g=h,d=s(1656),m=(0,d.A)(g,n,o,!1,null,"a0900ad8",null),f=m.exports},6846:function(e,t){var s={base_url:"http://uyuzvw.natappfree.cc",ws_url:"ws://uyuzvw.natappfree.cc"};try{window&&(window.config=window.config?Object.assign(s,window.config):s,s=window.config)}catch(n){console.log(n)}try{t.$=s}catch(n){console.log(n)}},7741:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{yw:function(){return dateStr}});var core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(4114),core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_push_js__WEBPACK_IMPORTED_MODULE_0__);function formatDateTime(e){let t=e.getFullYear(),s=e.getMonth()+1;s=s<10?"0"+s:s;let n=e.getDate();n=n<10?"0"+n:n;let o=e.getHours();o=o<10?"0"+o:o;let r=e.getMinutes();r=r<10?"0"+r:r;let i=e.getSeconds();return i=i<10?"0"+i:i,t+"-"+s+"-"+n+" "+o+":"+r+":"+i}function getDayByMonth(e){var t=new Date,s=t.getFullYear(),n=new Date(s,e-1,32),o=32-n.getDate();return o}function guid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=16*Math.random()|0,s="x"===e?t:3&t|8;return s.toString(16)}))}function doreplace(newtml,word,nword){return newtml=newtml.replace(eval("/("+word+")/g"),nword),newtml}function dateStr(e){let t,s=(new Date).getTime();return s=parseInt(s-e)/1e3,s<600?"刚刚":s<3600&&s>=600?(t=Math.floor(s/60),t+"分钟前"):s<86400&&s>=3600?(t=Math.floor(s/60/60),t+"小时前"):s<259200&&s>=86400?(t=Math.floor(s/60/60/24),t+"天前"):(e=new Date(e),e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate())}function mergeImgs(e,t=15,s=15){return new Promise(((n,o)=>{const r=[],i=document.createElement("canvas");let l=document.documentElement.style.fontSize;l=parseFloat(l.split("px")[0]),i.width=4.4*l,i.height=4.4*l;const a=i.getContext("2d");e.map(((o,l)=>{const c=new Image;c.src=o,c.crossOrigin="Anonymous";let u=Math.floor(l/3),h=t*(l-3*u),g=s*u;c.onload=()=>{a.drawImage(c,h,g,t,s);const o=i.toDataURL("image/png");r.push(o),r[e.length-1]&&n(r[e.length-1])}}))}))}function scrollEvent(e,t){var s=document.getElementById(e),n=function(e){var s=0;e=e||window.event,e.wheelDelta?s=e.wheelDelta>0?-1:1:e.detail&&(s=e.detail>0?1:-1),t&&t(s)};s.addEventListener&&s.addEventListener("DOMMouseScroll",n,!1),s.onmousewheel=n}function getScrollTop(e){let t=document.getElementById(e);return t.scrollTop}function scrollBottom(e,t){let s=document.getElementById(e);s&&(s.scrollTop=s.scrollHeight),t&&t(s.scrollHeight)}const altList=["[生气]","[好奇]","[嘿嘿]","[思考]","[为难]","[哭笑]","[吐血]","[微笑]","[害怕]","[喜欢]","[睁眼]","[酷炫]","[哭泣]","[害羞]","[闭嘴]","[睡觉]","[大哭]","[尴尬]","[嘻嘻]","[超生气]","[哼]","[害]","[粑粑]","[鄙视]","[无语]","[努力]","[鼓掌]","[吓人]","[左哼]","[坏笑]","[疑问 ]","[哈哈]","[略略略]","[吐]","[嘤嘤]","[委屈呀]","[开心]","[打哈欠]","[抠鼻]","[哼哼]","[可爱]","[哭哭]","[惊讶]","[嘘]","[右哼]","[再见]","[嘻嘻嘻]","[亲亲]","[汗]","[吐槽]","[晕]","[想吃]]","[累了]]","[没眼看]","[大鼻孔]","[跳舞]"];let faceUtils={faces:()=>{let e={};for(let t=0;t<altList.length;t++)e[altList[t]]="./static/face/"+t+".gif";return e}};function transform(e){let t=function(e){return new RegExp("\\n*\\["+(e||"")+"(code|pre|div|span|p|table|thead|th|tbody|tr|td|ul|li|ol|li|dl|dt|dd|h2|h3|h4|h5)([\\s\\S]*?)]\\n*","g")},s=faceUtils.faces();return e&&(e=e.replace(/&(?!#?[a-zA-Z0-9]+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;").replace(/@(\S+)(\s+?|$)/g,'@<a href="javascript:;">$1</a>$2').replace(/face\[([^\s\\[\]]+?)]/g,(function(e){let t=e.replace(/^face/g,"");return'<img alt="'+s[t]+'" title="'+s[t]+'" src="'+s[t]+'">'})).replace(/img\[([^\s]+?)]/g,(function(e){let t=e.replace(/(^img\[)|(]$)/g,"");return'<img class="message-img" src="'+t+'" alt="消息图片不能加载">'})).replace(/file\([\s\S]+?\)\[[\s\S]*?]/g,(function(e){let t=(e.match(/file\(([\s\S]+?)\)\[/)||[])[1],s=(e.match(/\)\[([\s\S]*?)]/)||[])[1];return t?'<a class="message-file" href="'+t+'"><i class="ivu-icon ivu-icon-md-arrow-down"></i>'+(s||t)+"</a>":e})).replace(/audio\[([^\s]+?)]/g,(function(e){return'<div class="message-audio" data-src="'+e.replace(/(^audio\[)|(]$)/g,"")+'"><i class="layui-icon">&#xe652;</i><p>音频消息</p></div>'})).replace(/video\[([^\s]+?)]/g,(function(e){return'<div class="message-video"  data-src="'+e.replace(/(^video\[)|(]$)/g,"")+'"><i class="layui-icon">&#xe652;</i></div>'})).replace(/a\([\s\S]+?\)\[[\s\S]*?]/g,(function(e){let t=(e.match(/a\(([\s\S]+?)\)\[/)||[])[1],s=(e.match(/\)\[([\s\S]*?)]/)||[])[1];return t?'<a href="'+t+'" target="_blank">'+(s||t)+"</a>":e})).replace(t(),"<$1 $2>").replace(t("/"),"</$1>").replace(/\n/g,"<br>")),e}function bSort(e,t){for(var s=e.length,n=0;n<s-1;n++)for(var o=0;o<s-1-n;o++)if(e[o][t]<e[o+1][t]){var r=e[o];e[o]=e[o+1],e[o+1]=r}return e}function getArrDifference(e,t){return e.concat(t).filter((function(e,t,s){return s.indexOf(e)===s.lastIndexOf(e)}))}let timeout=null;function delayFun(e,t){clearTimeout(timeout),timeout=setTimeout((()=>{e()}),t)}function strToNum(e){let t=e.split(",");if(t.length>0){let e="";return t.forEach((t=>{e+=t})),e}return 0}function unique(e){return e.filter((function(e,t,s){return s.indexOf(e)===t}))}function addChineseUnit(e,t){t=null==t?2:t;const s=[{value:1,symbol:""},{value:1e3,symbol:"K"},{value:1e6,symbol:"M"},{value:1e9,symbol:"B"},{value:1e12,symbol:"T"},{value:1e15,symbol:"P"},{value:1e18,symbol:"E"}],n=/\.0+$|(\.[0-9]*[1-9])0+$/;let o;for(o=s.length-1;o>0;o--)if(e>=s[o].value)break;if(e<1e3)return Number(e).toFixed(t);let r=(e/s[o].value).toFixed(t).replace(n,"$1")+s[o].symbol;return r}function NumFormat(e){let t=Number(e),s=t.toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,");return s}function isNull(e){if(""===e)return!0;var t="^[ ]+$",s=new RegExp(t);return s.test(e)}function isvalidPhone(e){const t=/^1[3|4|5|7|8][0-9]\d{8}$/;return t.test(e)}function isPassword(e){const t=/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,24}$/;return t.test(e)}}}]);
//# sourceMappingURL=about.8de09b6a.js.map